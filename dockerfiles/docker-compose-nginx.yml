version: '3.8'
# docker-compose -f dockerfiles/docker-compose-nginx.yml up --build

services:
  # The Flask Application Service
  app:
    build:
      context: ..
      dockerfile: dockerfiles/Dockerfile
    container_name: werewolves_app
    restart: unless-stopped
    env_file:
      - ../.env.werewolves
    expose:
      # Expose port 5000 to the internal Docker network, but not to the host machine
      - "5000"
    volumes:
      # Mount the current directory into the container for easy development changes
      # For pure production, you might remove this volume mount
      - ..:/werewolves_game

  # The Nginx Reverse Proxy Service
  nginx:
    image: nginx:latest
    container_name: werewolves_nginx
    restart: unless-stopped
    ports:
      # Maps host port (defined in .env.werewolves) to Nginx
      - "${NGINX_PORT:-5000}:80"
      # If you set up SSL, you would also map port 443
      # - "443:443"
    volumes:
      # Mount the Nginx configuration file
      - ../nginx/nginx.conf:/etc/nginx/conf.d/default.conf
      # If you set up SSL with Let's Encrypt, you would add volumes for certificates
      # - ./nginx/letsencrypt:/etc/letsencrypt
    depends_on:
      - app

