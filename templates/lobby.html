<!-- Version: 4.9.1 -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Werewolves Lobby</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='lobby.css') }}"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <script src="{{ url_for('static', filename='socket.io.min.js') }}"></script>
  </head>
  <body>
    <div class="lobby-container">
      <h2>Lobby - Waiting for Players</h2>
      <p id="game-code-area" style="display: none; margin-bottom: 5px">
        Game Code: <strong id="game-code-display"></strong>
      </p>
      <h3 style="margin: 0px">
        Players:
        <button id="add-player-btn">Add Player</button>
      </h3>
      <ul id="player-list"></ul>
      <div id="role-summary-container">
        <strong>ROLE COUNT:</strong>
        <span id="role-summary-text">Waiting for players...</span>
      </div>
      <div class="chat-container">
        <h4>Lobby Chat</h4>
        <div id="chat-messages" class="chat-messages"></div>
        <form id="chat-form" action="#">
          <input
            id="chat-input"
            type="text"
            placeholder="Type a message..."
            autocomplete="off"
          />
          <button id="chat-send-btn" type="submit">Send</button>
        </form>
      </div>

      <div id="admin-panel" style="display: none">
        <hr />
        <h3>Admin Controls</h3>
        <div style="margin-bottom: 20px">
          <button id="start-game-btn" disabled>Start Game</button>
          <p id="min-players-warning">
            <small style="color: firebrick"
              >Need at least 4 players to start.</small
            >
          </p>
        </div>

        <div class="admin-controls">
          <div class="settings-row">
            <div class="settings-group">
              <h4>Game Mode</h4>

              <label>
                <input type="checkbox" id="mode-pass-and-play" />
                <div>
                  <strong>Pass-and-Play Mode</strong><br />
                  <small style="color: darkgray"
                    >Single device mode. Pauses turns.</small
                  >
                </div>
              </label>

              <label>
                <input type="checkbox" id="mode-solo-ends-game" />
                <div>
                  <strong>Solo win ends game</strong><br />
                  <small style="color: darkgray"
                    >Don't wait for team wins.</small
                  >
                </div>
              </label>

              <label>
                <input type="checkbox" id="ghost-mode-checkbox" />
                <div>
                  <strong>Enable Ghost Mode</strong><br />
                  <small style="color: darkgray"
                    >Dead can vote...sometimes.</small
                  >
                </div>
              </label>
            </div>

            <div class="settings-group">
              <h4>Timer Settings (+30sec)</h4>
              <div>
                <label for="disable-timers-checkbox" style="color: gainsboro">
                  <input type="checkbox" id="disable-timers-checkbox" />
                  <strong>Disable Timers</strong>
                </label>
              </div>

              <div id="timer-options" class="timer-options">
                <div class="timer-input-row">
                  <label for="night-timer-input">Night (sec):</label>
                  <input
                    type="number"
                    id="night-timer-input"
                    value="90"
                    min="30"
                    style="width: 70px"
                  />
                </div>
                <div class="timer-input-row">
                  <label for="accusation-timer-input">Accusation (sec):</label>
                  <input
                    type="number"
                    id="accusation-timer-input"
                    value="90"
                    min="30"
                    style="width: 70px"
                  />
                </div>
                <div class="timer-input-row">
                  <label for="lynch-vote-timer-input">Lynch Vote (sec):</label>
                  <input
                    type="number"
                    id="lynch-vote-timer-input"
                    value="60"
                    min="30"
                    style="width: 70px"
                  />
                </div>
              </div>

              <button id="set-timers-btn" style="width: 50%; margin-top: 10px">
                Set Timers
              </button>
            </div>
          </div>
        </div>
        <div class="admin-controls">
          <h4>
            Roles
            <button id="random-roles-btn" onclick="selectRandomRoles()">
              ðŸŽ² Select Random Roles
            </button>

            <span class="rating-legend-wrapper">
              <span class="info-icon">ðŸ’¡ Rating Guide</span>
              <div class="legend-tooltip">
                <strong>Role Balance Rating:</strong>
                <div class="legend-item">
                  <span class="dot" style="background: blue"></span> + Positive:
                  Villager Alligned
                </div>
                <div class="legend-item">
                  <span class="dot" style="background: darkviolet"></span> ~
                  Zero: Neutral / Unknown
                </div>
                <div class="legend-item">
                  <span class="dot" style="background: crimson"></span> -
                  Negative: Werewolf Aligned
                </div>
                <hr style="border-color: #444; margin: 5px 0" />
                <small
                  >"Random" button selects balanced roles with a total value
                  close to 0.</small
                >
              </div>
            </span>
          </h4>
          <div id="roles-grid">
            <p>Loading roles...</p>
          </div>
        </div>

        <div class="admin-controls">
          <label for="new-game-code-input">Set New Game Code:</label>
          <input
            type="text"
            id="new-game-code-input"
            placeholder="New Code"
            style="margin: 8px"
          />
          <button id="set-code-btn">Set Code</button>
          <button id="toggle-chat-btn" style="margin-left: 10px">
            Toggle Admin Chat
          </button>
        </div>
      </div>
    </div>
    <script>
      let currentPlayerId = "{{ player_id }}";
    </script>
    <script src="{{ url_for('static', filename='lobby.js') }}"></script>
  </body>
</html>
