<!-- Version: 4.9.9 -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Werewolves Lobby</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='lobby.css') }}"
    />
    <script src="{{ url_for('static', filename='purify.min.js') }}"></script>
    <script src="{{ url_for('static', filename='socket.io.min.js') }}"></script>
  </head>
  <body>
    <div class="lobby-container">
      <h2 data-i18n="ui.lobby.title">Lobby - Waiting for Players</h2>
      <p id="game-code-area" style="display: none; margin-bottom: 5px">
        <span data-i18n="ui.lobby.game_code">Game Code:</span>
        <strong id="game-code-display"></strong>
      </p>

      <h3 style="margin: 0px">
        <span data-i18n="ui.lobby.players_header">Players:</span>
        <button id="add-player-btn" data-i18n="ui.lobby.add_player_btn">
          Add Player
        </button>
      </h3>
      <ul id="player-list"></ul>

      <div id="role-summary-container">
        <strong data-i18n="ui.lobby.role_count_label">ROLE COUNT:</strong>
        <span id="role-summary-text" data-i18n="ui.lobby.waiting_text"
          >Waiting for players...</span
        >
      </div>

      <div class="chat-container">
        <h4 data-i18n="ui.lobby.chat_header">Lobby Chat</h4>
        <div id="chat-messages" class="chat-messages"></div>
        <form id="chat-form" action="#">
          <input
            id="chat-input"
            type="text"
            placeholder="Type a message..."
            autocomplete="off"
            data-i18n-placeholder="ui.lobby.chat_placeholder"
          />
          <button
            id="chat-send-btn"
            type="submit"
            data-i18n="ui.lobby.send_btn"
          >
            Send
          </button>
        </form>
      </div>

      <div id="admin-panel" style="display: none">
        <hr />
        <h3 data-i18n="ui.lobby.admin_header">Admin Controls</h3>
        <div style="margin-bottom: 20px">
          <button
            id="start-game-btn"
            disabled
            data-i18n="ui.lobby.start_game_btn"
          >
            Start Game
          </button>
          <p id="min-players-warning">
            <small
              style="color: firebrick"
              data-i18n="ui.lobby.min_players_warning"
              >Need at least 4 players to start.</small
            >
          </p>
        </div>

        <div class="admin-controls">
          <div class="settings-row">
            <div class="settings-group">
              <h4 data-i18n="ui.lobby.game_mode_header">Game Mode</h4>

              <label>
                <input type="checkbox" id="mode-pass-and-play" />
                <div>
                  <strong data-i18n="ui.lobby.pnp_mode"
                    >Pass-and-Play Mode</strong
                  ><br />
                  <small style="color: darkgray" data-i18n="ui.lobby.pnp_desc"
                    >Single device mode. Pauses turns.</small
                  >
                </div>
              </label>

              <label>
                <input type="checkbox" id="mode-solo-ends-game" />
                <div>
                  <strong data-i18n="ui.lobby.solo_win_mode"
                    >Solo win ends game</strong
                  ><br />
                  <small
                    style="color: darkgray"
                    data-i18n="ui.lobby.solo_win_desc"
                    >Don't wait for team wins.</small
                  >
                </div>
              </label>

              <label>
                <input type="checkbox" id="ghost-mode-checkbox" />
                <div>
                  <strong data-i18n="ui.lobby.ghost_mode"
                    >Enable Ghost Mode</strong
                  ><br />
                  <small style="color: darkgray" data-i18n="ui.lobby.ghost_desc"
                    >Dead can vote...sometimes.</small
                  >
                </div>
              </label>
            </div>

            <div class="settings-group">
              <h4 data-i18n="ui.lobby.timers_header">
                Timer Settings (+30sec)
              </h4>
              <div>
                <label for="disable-timers-checkbox" style="color: gainsboro">
                  <input type="checkbox" id="disable-timers-checkbox" />
                  <strong data-i18n="ui.lobby.disable_timers"
                    >Disable Timers</strong
                  >
                </label>
              </div>

              <div id="timer-options" class="timer-options">
                <div class="timer-input-row">
                  <label
                    for="night-timer-input"
                    data-i18n="ui.lobby.timer_night"
                    >Night (sec):</label
                  >
                  <input
                    type="number"
                    id="night-timer-input"
                    value="90"
                    min="30"
                    style="width: 70px"
                  />
                </div>
                <div class="timer-input-row">
                  <label
                    for="accusation-timer-input"
                    data-i18n="ui.lobby.timer_accusation"
                    >Accusation (sec):</label
                  >
                  <input
                    type="number"
                    id="accusation-timer-input"
                    value="90"
                    min="30"
                    style="width: 70px"
                  />
                </div>
                <div class="timer-input-row">
                  <label
                    for="lynch-vote-timer-input"
                    data-i18n="ui.lobby.timer_lynch"
                    >Lynch Vote (sec):</label
                  >
                  <input
                    type="number"
                    id="lynch-vote-timer-input"
                    value="60"
                    min="30"
                    style="width: 70px"
                  />
                </div>
              </div>

              <button
                id="set-timers-btn"
                style="width: 50%; margin-top: 10px"
                data-i18n="ui.lobby.set_timers_btn"
              >
                Set Timers
              </button>
            </div>
          </div>
        </div>
        <div class="admin-controls">
          <h4>
            <span data-i18n="ui.lobby.roles_header">Roles</span>
            <button
              id="random-roles-btn"
              onclick="selectRandomRoles()"
              data-i18n="ui.lobby.random_roles_btn"
            >
              ðŸŽ² Select Random Roles
            </button>

            <span class="rating-legend-wrapper">
              <span class="info-icon" data-i18n="ui.lobby.rating_guide"
                >ðŸ’¡ Rating Guide</span
              >
              <div class="legend-tooltip">
                <strong data-i18n="ui.lobby.rating_title"
                  >Role Balance Rating:</strong
                >
                <div class="legend-item">
                  <span class="dot" style="background: blue"></span>
                  <span data-i18n="ui.lobby.rating_pos"
                    >+ Positive: Villager Aligned</span
                  >
                </div>
                <div class="legend-item">
                  <span class="dot" style="background: darkviolet"></span>
                  <span data-i18n="ui.lobby.rating_neu"
                    >~ Zero: Neutral / Unknown</span
                  >
                </div>
                <div class="legend-item">
                  <span class="dot" style="background: crimson"></span>
                  <span data-i18n="ui.lobby.rating_neg"
                    >- Negative: Werewolf Aligned</span
                  >
                </div>
                <hr style="border-color: #444; margin: 5px 0" />
                <small data-i18n="ui.lobby.rating_note"
                  >"Random" button selects balanced roles with a total value
                  close to 0.</small
                >
              </div>
            </span>
          </h4>
          <div id="roles-grid">
            <p>Loading roles...</p>
          </div>
        </div>

        <div class="admin-controls">
          <label for="new-game-code-input" data-i18n="ui.lobby.set_code_label"
            >Set New Game Code:</label
          >
          <input
            type="text"
            id="new-game-code-input"
            placeholder="New Code"
            style="margin: 8px"
            data-i18n-placeholder="ui.lobby.new_code_placeholder"
          />
          <button id="set-code-btn" data-i18n="ui.lobby.set_code_btn">
            Set Code
          </button>
          <button
            id="toggle-chat-btn"
            style="margin-left: 10px"
            data-i18n="ui.lobby.toggle_chat_btn"
          >
            Toggle Admin Chat
          </button>
        </div>
      </div>
    </div>
    <script>
      let currentPlayerId = "{{ player_id }}";
      window.userLang = "{{ session.get('language', 'en') }}";
    </script>
    <script src="{{ url_for('static', filename='lobby.js') }}"></script>
  </body>
</html>
